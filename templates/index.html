<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="{{url_for('static', filename='images/fsulogo.jpg')}}" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker</title>
</head>
<link rel="stylesheet" href="{{url_for('static', filename='styles.css')}}">
<body>
    <div class="navbar">
        <div class="logoAndTitleHolder">
            <div class="logoHolder" onclick="document.location='{{url_for('index')}}'"></div>
            <h1>FSU TASK TRACKER</h1>
        </div>
        <div class="userHolder" onclick="document.location='{{url_for('login')}}'">
            <div class="profilePicHolder"></div>
            <h4>Hello {{user_name}}!</h4>
        </div>
    </div>
    <div class="sortHolder">
        <div>
            <label for="taskType">Task type:</label>
            <select name="taskType" id="taskType">
                <option value="all">All</option>
                <option value="task_assigned_to">Assigned to me</option>
                <option value="task_assigned_by">Assigned by me</option>
            </select>
            </div>
            <div>
            <label for="sortBy">Sort By:</label>
            <select name="sortBy" id="sortBy">
                <option value="default">Default</option>
                <option value="task_deadline">Due Date</option>
                <option value="task_percentage">Percentage Finished</option>
            </select>
        </div>
        <button type="button" onclick="sortData()">Sort</button>
    </div>
    <div class="body">
        <div class="contentHolder" id="contentHolder">
            <!-- JS will inject content here -->
        </div>
        <div class="sidebar">
            <div class="buttons">
                <button class="add" type="button" onclick="document.location='{{url_for('form')}}'">+</button>
                <button class="archive add" type="button" onclick="document.location='{{url_for('completed.showCompletedTask')}}'">O</button>
            </div>
        </div>
    </div>
</body>
<script>
    function outputData(){
    return {{ client_data|tojson }};
    }
    function editData(i,j){
        document.location= `{{url_for('edit.edit')}}?task_id=${i}&task_id_db=${j}`;
    }
    function finishData(i,j){
        document.location= `{{url_for('archive.archiveTask')}}?task_id=${i}&task_id_db=${j}`;
    }
    function deleteData(i,j){
        if(confirm("Are you sure you want to delete this task?")){
            document.location= `{{url_for('taskHandler.deleteTask')}}?task_id=${i}&task_id_db=${j}`;
        }
    }
    function sortData(){
        const taskType = document.getElementById("taskType").value;
        const sortBy = document.getElementById("sortBy").value;
        console.log("Sorting by:", sortBy, "Task type:", taskType);
        document.location=`{{url_for('index')}}?task_type=${taskType}&sort_by=${sortBy}`;
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const contentHolder = document.getElementById('contentHolder');
        const data = outputData();
        localStorage.setItem("Data",JSON.stringify(data));
        console.log(data);
        function loadAllData(){
            contentHolder.innerHTML="";
            for(let i =0 ;i<data.length;i++){
            contentHolder.innerHTML+=`<div class="contentBox">
                <div class="title">
                    <h3>${data[i][1]}</h3>
                    <h3>-${data[i][2]}</h3>
                </div>
                <div class="progressBar">
                    <div class="progress" style="width:${data[i][8]}%;"></div>
                </div>
                <div class="numericData">
                    <h6>${data[i][4]}</h6>
                    <h6>${data[i][7]}</h6>
                </div>
                <div class="extraContent">
                    <hr>
                    <div>
                        <div class="taskDetails">
                            <p>Task Description: ${data[i][5]}</p>
                            <p>Progress: ${data[i][6]}</p>
                            <p>Remaining: ${data[i][7]}</p>
                        </div>
                        <div class="peopleDetails">
                            <div class="peopleWorking">People Working: ${data[i][9]}</div>
                            <div class="assignedBy">Assigned By: ${data[i][3]}</div>
                        </div>
                    </div>
                    <div class="ButtonHolder">
                            <button type="button" class="deleteButton" onclick="deleteData(${i},${data[i][0]})">Delete</button>
                            <button type="button" class="finishButton" onclick="finishData(${i},${data[i][0]})">Finished</button>
                            <button type="button" class="editButton" onclick="editData(${i},${data[i][0]})">Edit</button>
                    </div>
                </div>
            </div>`
            


            // Add click event listener to the newly created content box
            addToggleEventListeners();
            }
        }
        
        // Function to add toggle event listeners to all content boxes
        function addToggleEventListeners() {
            const contentBoxes = document.querySelectorAll('.contentBox');
            contentBoxes.forEach(box => {
                box.removeEventListener('click', toggleExtraContent);
                box.addEventListener('click', toggleExtraContent);
            });
        }
        
        // Function to toggle extra content visibility
        function toggleExtraContent(event) {
            const extraContent = this.querySelector('.extraContent');
            if (extraContent) {
                if (extraContent.style.display === 'none' || extraContent.style.display === '') {
                    extraContent.style.display = 'block';
                } else {
                    extraContent.style.display = 'none';
                }
            }
        }
        
        // Initialize event listeners for any existing content boxes
        loadAllData();
        addToggleEventListeners();
        
    }); 

</script>

<script>
       
</script>
</html>